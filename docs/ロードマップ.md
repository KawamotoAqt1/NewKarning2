了解しました！
以下、**社内共有にそのまま使えるレベルの完成度**で、
**「表札自動レイアウト（カーニング）開発ロードマップ」仕様書（Markdown形式）」** を作成します。

読みやすさ・説得力・今後の意思決定のしやすさを重視しています。

---

# 📘 **表札自動レイアウトエンジン

開発ロードマップ（Phase0 → Phase3 完成形）**

---

## 🎯 **本ドキュメントの目的**

本資料は、表札自動レイアウト機能（カーニング）の
**開発方針・精度改善ロードマップ**を明確化し、
“どこまでやれば製品として成立するか” を社内で共有することを目的とします。

* 文字組み合わせは無限
* フォント種は 100 以上
* デザインテンプレも多様

という中で、
**限られたコストで最大の精度向上を得るための現実的な段階設計**を示します。

---

# 🧱 **全体アーキテクチャ（概要）**

本プロジェクトのレイアウトエンジンは、
以下の 4 段階構造で完成させる方針とします。

```
Phase0：ルールベース（ペア局所最適）
Phase1：軽い学習で「ロジックの重み」を調整
Phase2：全体バランス（3文字以上）の最適化
Phase3：運用データで精度を“育てる”完成系
```

---

# ------------------------------------------------------------

# 🎯 **Phase0：ルールベースだけで“まず動かす”PoC**

# ------------------------------------------------------------

## 目的

* 固定トラッキングより明らかに美しくする。
* 「この方向性で投資する価値があるか」を判断する。

## 内容

### 1. 文字特徴の抽出（自動）

* Canvas またはフォントメトリクスから取得

  * 文字幅
  * 黒密度（3段階：LIGHT / MEDIUM / HEAVY）
  * 縦長 / 横長の比率
  * 文字種（漢字 / ひらがな / 英字）

### 2. ペア（2文字間）カーニングロジック

* フォントファミリー別 baseTracking
* pairCategory（縦×縦、丸×丸、斜線含む）補正
* 黒密度組み合わせ補正

### 3. ギャップ計算（Phase0 時点）

```
gap = baseTracking + pairAdjust + densityAdjust
```

## 評価基準

* 代表名字 & 代表フォントで 10〜20 パターン検証
* デザイナー評価が

  * 「毎回ゼロから調整」 → 「微調整で済む」
    に変われば成功

## Phase0 の意思決定ポイント

* ルールだけでも **大幅に改善が感じられるか？**
* 改善が薄い場合は Phase1 以降へ進まず撤退を検討

---

# ------------------------------------------------------------

# 🎯 **Phase1：軽い学習で“重み”を調整（精度の底上げ）**

# ------------------------------------------------------------

## 目的

* ルールベースの補正値に「効き具合」の重み付けを行い、
  **人間らしい間隔**に寄せる。

## 内容

### 1. AI ファイル（デザイナー仕上げ）から学習データ収集

* 対象フォント：代表 3〜5 種
* 1 フォントあたり 10〜20 デザイン
  → 合計 30〜60 デザイン

### 2. 最適化対象（重み）

```
gap_final =
  baseTracking
  + w_pair    * pairAdjust
  + w_density * densityAdjust
  + w_style   * styleAdjust
```

### 3. 学習方法（軽量）

* AIファイルから

  * gap_actual（実際の文字間隔）を抽出
  * Phase0 の gap_ideal と比較
* `delta = actual - ideal` を最小化するように、
  **w_pair, w_density, w_style を線形回帰で求める**

※ 重みは数個〜十数個に限定（パラメータ爆発を防ぐ）

## 評価基準

* 「修正不要」＋「微修正」の割合が 70〜80% に到達
* Phase0 → Phase1 で **明確に体感できる改善**があるか

## go／no-go 判断

* 学習で大きく改善 → Phase2へ
* 改善がほぼない → Phase3 以降の大規模施策には進まない

---

# ------------------------------------------------------------

# 🎯 **Phase2：3文字以上の“全体最適化”を入れて商用品質へ**

# ------------------------------------------------------------

## 目的

* ペア最適（部分最適）＋全体最適を組み合わせ、
  **売れ筋テンプレ × よくある名字で 80〜90% を自動レイアウト可能**にする。

## 内容

### 1. 局所（ペア）最適による gap_local を計算

Phase1 のロジックをそのまま使用。

### 2. 全体バランス（global）補正

#### ✔ 重心補正

* 黒密度 × 文字幅から文字列の **centerOfMass** を計算
* 左右に寄っていれば、gap を微調整し再センタリング

#### ✔ ギャップ分布の均し（標準偏差補正）

* gap の標準偏差が大きい場合、
  → ばらつきを均す “smoothing” をかける

#### ✔ 3文字以上の連続パターン調整（Triplet補正）

* 縦線 × 縦線 × 縦線 → 少し広げる
* 丸 × 丸 × 丸 → 少し締める
* 筆文字で stroke が重い連続 → 緩くする

### 3. 対象データ

* フォントファミリー 10 種（全体）
* 各ファミリー 20 デザイン（計 200 ほど）

## 評価基準

* 売れ筋テンプレ × よく出る名字の領域で
  **80〜90% が「微修正で済む」** または「修正不要」

---

# ------------------------------------------------------------

# 🎯 **Phase3：運用フェーズで“育てる”完成形**

# ------------------------------------------------------------

## 目的

* 実運用データ（受注〜生産の AI ファイル群）を活用し、
  **精度を継続的に向上**させる。

## 内容

### 1. 本番で蓄積されるデータを活用

* デザイナーが調整した AI ファイルを定期収集
* 「ズレの多いパターン」「クレームの多い名字」を重点補正

### 2. 精度改善ループ（PDCA）

1. 問題のある文字列を抽出
2. ペア／Triplet／重心補正の誤差を分析
3. 影響の大きい重み w または補正値を調整
4. エンジンに反映
5. 次の運用で確認

### 3. 必要最小限の拡張のみ

* 特定の名字ペア専用の補正は **無限には作らない**
* ごく一部の「例外ケース」だけ個別補正テーブルで吸収

## 完成形の状態

* 2文字ペアの局所最適
* 3文字以上の全体最適
* フォントファミリー別の味付け
* 学習済みの「重み」
* 運用で育てた修正値

これらが組み合わさり、

> **ユーザーが名前を入力すると、
> デザイナー品質の表札レイアウトがほぼ自動で生成される。**

状態。

---

# 🚀 **まとめ**

| Phase      | 位置づけ  | 主な内容        | 成果                |
| ---------- | ----- | ----------- | ----------------- |
| **Phase0** | PoC   | ルールベース（ペア）  | 固定トラッキングより改善するか確認 |
| **Phase1** | ライト学習 | 重み付け（回帰）    | 人間らしいバランスに近づく     |
| **Phase2** | 商用実用  | 全体最適（3文字以上） | 売れ筋領域で 80〜90% 自動化 |
| **Phase3** | 完成系   | 運用で育てる      | 長期的に精度維持・改善       |

---

もし必要であれば、この資料を **Googleドキュメント版、Confluence版、社内Wiki版** などに最適化した形でも書き直せます。

どの形式にしましょう？
